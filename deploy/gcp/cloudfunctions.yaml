# Google Cloud Functions Configuration for ABI
#
# Deploy with:
#   gcloud functions deploy abi-function \
#     --gen2 \
#     --runtime=provided \
#     --region=us-central1 \
#     --source=. \
#     --entry-point=handler \
#     --trigger-http \
#     --allow-unauthenticated
#
# Or using this config file with gcloud CLI:
#   gcloud functions deploy --config=cloudfunctions.yaml
#
# Prerequisites:
#   - Google Cloud SDK installed
#   - GCP project configured
#   - Zig toolchain for cross-compilation

# Function configuration
name: abi-function
description: ABI Framework Cloud Function

# Runtime configuration
runtime: provided
entryPoint: handler

# Resource configuration
availableMemoryMb: 256
timeout: 30s
maxInstances: 100
minInstances: 0

# Trigger configuration (HTTP)
httpsTrigger:
  securityLevel: SECURE_ALWAYS

# Environment variables
environmentVariables:
  LOG_LEVEL: info
  ABI_CLOUD_PROVIDER: gcp_functions
  FUNCTION_MEMORY_MB: '256'

# Service account (optional - uses default if not specified)
# serviceAccountEmail: abi-function@PROJECT_ID.iam.gserviceaccount.com

# VPC connector (optional - for private network access)
# vpcConnector: projects/PROJECT_ID/locations/REGION/connectors/CONNECTOR_NAME
# vpcConnectorEgressSettings: PRIVATE_RANGES_ONLY

# Ingress settings
ingressSettings: ALLOW_ALL

# Labels for organization
labels:
  app: abi
  component: cloud-function
  managed-by: abi-framework

---
# Alternative: Event-driven function (Pub/Sub trigger)
# Uncomment to use instead of HTTP trigger

# name: abi-pubsub-function
# description: ABI Framework Pub/Sub Function

# runtime: provided
# entryPoint: handler

# availableMemoryMb: 256
# timeout: 60s

# eventTrigger:
#   eventType: google.cloud.pubsub.topic.v1.messagePublished
#   pubsubTopic: projects/PROJECT_ID/topics/TOPIC_NAME
#   retryPolicy: RETRY_POLICY_RETRY

# environmentVariables:
#   LOG_LEVEL: info
#   ABI_CLOUD_PROVIDER: gcp_functions
#   FUNCTION_TYPE: pubsub

---
# Alternative: Cloud Storage trigger
# Uncomment to use for file processing

# name: abi-storage-function
# description: ABI Framework Storage Function

# runtime: provided
# entryPoint: handler

# availableMemoryMb: 512
# timeout: 120s

# eventTrigger:
#   eventType: google.cloud.storage.object.v1.finalized
#   eventFilters:
#     - attribute: bucket
#       value: YOUR_BUCKET_NAME
#   retryPolicy: RETRY_POLICY_RETRY

# environmentVariables:
#   LOG_LEVEL: info
#   ABI_CLOUD_PROVIDER: gcp_functions
#   FUNCTION_TYPE: storage

---
# Alternative: Firestore trigger
# Uncomment to use for database changes

# name: abi-firestore-function
# description: ABI Framework Firestore Function

# runtime: provided
# entryPoint: handler

# availableMemoryMb: 256
# timeout: 30s

# eventTrigger:
#   eventType: google.cloud.firestore.document.v1.written
#   eventFilters:
#     - attribute: database
#       value: (default)
#     - attribute: document
#       value: users/{userId}
#       operator: match-path-pattern
#   retryPolicy: RETRY_POLICY_RETRY

# environmentVariables:
#   LOG_LEVEL: info
#   ABI_CLOUD_PROVIDER: gcp_functions
#   FUNCTION_TYPE: firestore

---
# Deployment script helper
# Save this as deploy.sh and make executable

# #!/bin/bash
# set -e
#
# PROJECT_ID="${GCP_PROJECT:-your-project-id}"
# REGION="${GCP_REGION:-us-central1}"
# FUNCTION_NAME="${FUNCTION_NAME:-abi-function}"
#
# echo "Building Zig binary for Linux..."
# zig build -Dtarget=x86_64-linux-gnu -Doptimize=ReleaseFast
#
# echo "Deploying to Google Cloud Functions..."
# gcloud functions deploy "$FUNCTION_NAME" \
#   --gen2 \
#   --runtime=provided \
#   --region="$REGION" \
#   --source=./zig-out/bin \
#   --entry-point=handler \
#   --trigger-http \
#   --allow-unauthenticated \
#   --memory=256MB \
#   --timeout=30s \
#   --set-env-vars="LOG_LEVEL=info,ABI_CLOUD_PROVIDER=gcp_functions"
#
# echo "Deployment complete!"
# gcloud functions describe "$FUNCTION_NAME" --region="$REGION" --format="value(serviceConfig.uri)"
