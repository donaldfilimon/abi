<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ABI Documentation</title>
  <meta name="description"
    content="Comprehensive documentation for the ABI ecosystem with advanced search and navigation features" />
  <meta name="keywords" content="ABI, documentation, API, reference, programming" />
  <meta name="author" content="ABI Team" />

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="ABI Documentation" />
  <meta property="og:description"
    content="Comprehensive documentation for the ABI ecosystem with advanced search and navigation features" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://donaldfilimon.github.io/abi/" />

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ABI Documentation" />
  <meta name="twitter:description"
    content="Comprehensive documentation for the ABI ecosystem with advanced search and navigation features" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- External Stylesheets -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0b0d10;
      --fg: #e6edf3;
      --muted: #9aa4b2;
      --accent: #5eb1ff;
      --accent-hover: #4ea3f0;
      --panel: #111418;
      --border: #1f2328;
      --hover: rgba(94, 177, 255, 0.12);
      --code-bg: #0f1216;
      --warning: #f85149;
      --success: #2ea043;
      --info: #1f6feb;
      --shadow: rgba(0, 0, 0, 0.3);
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      color-scheme: light dark;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #ffffff;
        --fg: #24292f;
        --muted: #656d76;
        --accent: #0969da;
        --accent-hover: #0860ca;
        --panel: #f6f8fa;
        --border: #d0d7de;
        --hover: rgba(9, 105, 218, 0.08);
        --code-bg: #f6f8fa;
        --warning: #cf222e;
        --success: #1a7f37;
        --info: #0969da;
        --shadow: rgba(0, 0, 0, 0.1);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      font-size: 14px;
      line-height: 1.5;
      color: var(--fg);
      background: var(--bg);
      display: grid;
      grid-template-columns: 320px 1fr;
      height: 100svh;
      overflow: hidden;
      transition: var(--transition);
    }

    @media (max-width: 1024px) {
      body {
        grid-template-columns: 280px 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        height: 100vh;
      }

      aside {
        border-right: none;
        border-bottom: 1px solid var(--border);
        max-height: 50vh;
        overflow-y: auto;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: 13px;
      }

      aside {
        padding: 12px;
        max-height: 45vh;
      }
    }

    aside {
      background: var(--panel);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 16px;
      overflow: hidden;
      box-shadow: 2px 0 8px var(--shadow);
      z-index: 10;
    }

    main {
      overflow: auto;
      padding: 24px 32px;
      background: var(--bg);
      position: relative;
    }

    @media (max-width: 768px) {
      main {
        padding: 16px 20px;
      }
    }

    @media (max-width: 480px) {
      main {
        padding: 12px 16px;
      }
    }

    #brand {
      font-weight: 700;
      letter-spacing: 0.2px;
      margin-bottom: 8px;
      font-size: 1.25em;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #brand .bi {
      font-size: 1.2em;
    }

    #desc {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 16px;
      line-height: 1.4;
    }

    #search {
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--code-bg);
      color: var(--fg);
      outline: none;
      width: 100%;
      font-family: inherit;
      font-size: 14px;
      transition: var(--transition);
      box-shadow: 0 1px 3px var(--shadow);
    }

    #search:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(94, 177, 255, 0.1);
    }

    #search::placeholder {
      color: var(--muted);
    }

    #nav {
      overflow: auto;
      margin-top: 16px;
      padding-right: 6px;
      flex: 1;
    }

    #nav::-webkit-scrollbar {
      width: 6px;
    }

    #nav::-webkit-scrollbar-track {
      background: transparent;
    }

    #nav::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    #nav::-webkit-scrollbar-thumb:hover {
      background: var(--muted);
    }

    .nav-item {
      padding: 12px 12px;
      border-radius: 8px;
      margin-bottom: 4px;
      transition: var(--transition);
      cursor: pointer;
      border: 1px solid transparent;
    }

    .nav-item:hover {
      background: var(--hover);
      border-color: var(--border);
      transform: translateX(2px);
    }

    .nav-item.active {
      background: var(--hover);
      border-color: var(--accent);
      box-shadow: 0 2px 8px var(--shadow);
    }

    .nav-item a {
      color: var(--fg);
      text-decoration: none;
      font-weight: 500;
      display: block;
      font-size: 14px;
    }

    .nav-item.active a {
      color: var(--accent);
      font-weight: 600;
    }

    .nav-excerpt {
      color: var(--muted);
      font-size: 12px;
      margin-top: 6px;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      overflow: hidden;
    }

    .nav-category {
      margin-top: 24px;
      margin-bottom: 12px;
    }

    .nav-category:first-child {
      margin-top: 16px;
    }

    .nav-category-title {
      color: var(--accent);
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      padding: 0 12px 8px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 8px;
    }

    /* Content styling */
    #content {
      max-width: 1200px;
      margin: 0 auto;
      line-height: 1.7;
      word-wrap: break-word;
    }

    #content h1,
    #content h2,
    #content h3,
    #content h4,
    #content h5,
    #content h6 {
      margin-top: 2.5em;
      margin-bottom: 0.75em;
      color: var(--fg);
      font-weight: 600;
      line-height: 1.3;
    }
    /* Ensure anchored headings are visible below sticky UI */
    #content h1[id],
    #content h2[id],
    #content h3[id],
    #content h4[id],
    #content h5[id],
    #content h6[id] {
      scroll-margin-top: 80px;
    }

    #content h1:first-child,
    #content h2:first-child,
    #content h3:first-child {
      margin-top: 0;
    }

    #content h1 {
      font-size: 2em;
      border-bottom: 2px solid var(--border);
      padding-bottom: 0.5em;
      margin-bottom: 1em;
    }

    #content h2 {
      font-size: 1.5em;
      border-bottom: 1px solid var(--border);
      padding-bottom: 0.3em;
    }

    #content h3 {
      font-size: 1.25em;
    }

    #content h4 {
      font-size: 1.1em;
    }

    #content h5,
    #content h6 {
      font-size: 1em;
    }

    #content p {
      margin: 1em 0;
    }

    #content pre {
      background: var(--code-bg);
      padding: 20px;
      border-radius: 8px;
      overflow: auto;
      border: 1px solid var(--border);
      margin: 1.5em 0;
      box-shadow: 0 2px 8px var(--shadow);
      position: relative;
    }

    #content pre::-webkit-scrollbar {
      height: 8px;
    }

    #content pre::-webkit-scrollbar-track {
      background: var(--border);
      border-radius: 4px;
    }

    #content pre::-webkit-scrollbar-thumb {
      background: var(--muted);
      border-radius: 4px;
    }

    #content code {
      background: var(--code-bg);
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 0.9em;
      border: 1px solid var(--border);
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    }

    #content pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: 0.85em;
    }

    #content a {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: var(--transition);
    }

    #content a:hover {
      color: var(--accent-hover);
      border-bottom-color: var(--accent);
    }

    #content a:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    #content blockquote {
      border-left: 4px solid var(--accent);
      padding: 16px 20px;
      margin: 1.5em 0;
      background: var(--hover);
      border-radius: 0 8px 8px 0;
      color: var(--fg);
      font-style: italic;
    }

    #content blockquote p:first-child {
      margin-top: 0;
    }

    #content blockquote p:last-child {
      margin-bottom: 0;
    }

    #content ul,
    #content ol {
      margin: 1em 0;
      padding-left: 2em;
    }

    #content li {
      margin: 0.5em 0;
    }

    #content table {
      border-collapse: collapse;
      width: 100%;
      margin: 1.5em 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px var(--shadow);
    }

    #content th,
    #content td {
      border: 1px solid var(--border);
      padding: 12px 16px;
      text-align: left;
    }

    #content th {
      background: var(--panel);
      font-weight: 600;
      color: var(--accent);
    }

    #content tbody tr:nth-child(even) {
      background: var(--hover);
    }

    #content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--shadow);
      margin: 1em 0;
    }

    #topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: -24px;
      background: var(--bg);
      z-index: 5;
      backdrop-filter: blur(10px);
    }

    @media (max-width: 768px) {
      #topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
    }

    #topbar .left {
      display: flex;
      gap: 12px;
      align-items: center;
      flex: 1;
    }

    #topbar .right {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    @media (max-width: 768px) {
      #topbar .right {
        width: 100%;
        justify-content: flex-start;
      }
    }

    button.small {
      background: var(--code-bg);
      border: 1px solid var(--border);
      color: var(--fg);
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
      font-weight: 500;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    button.small:hover {
      border-color: var(--accent);
      background: var(--hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow);
    }

    button.small:active {
      transform: translateY(0);
    }

    button.small:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .breadcrumb {
      color: var(--muted);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .breadcrumb a {
      color: var(--accent);
      text-decoration: none;
      transition: var(--transition);
    }

    .breadcrumb a:hover {
      color: var(--accent-hover);
    }

    .breadcrumb-separator {
      color: var(--muted);
      font-size: 12px;
    }

    .search-results {
      color: var(--muted);
      font-size: 12px;
      padding: 8px 12px;
      text-align: center;
      background: var(--hover);
      border-radius: 6px;
      margin-top: 8px;
    }

    .error-message {
      background: rgba(248, 81, 73, 0.1);
      border: 1px solid var(--warning);
      color: var(--warning);
      padding: 16px 20px;
      border-radius: 8px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .error-message .bi {
      font-size: 1.2em;
    }

    .success-message {
      background: rgba(46, 160, 67, 0.1);
      border: 1px solid var(--success);
      color: var(--success);
      padding: 16px 20px;
      border-radius: 8px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .success-message .bi {
      font-size: 1.2em;
    }

    .info-message {
      background: rgba(31, 111, 235, 0.1);
      border: 1px solid var(--info);
      color: var(--info);
      padding: 16px 20px;
      border-radius: 8px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .info-message .bi {
      font-size: 1.2em;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .progress-bar {
      width: 100%;
      height: 3px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-hover));
      width: 0%;
      transition: width 0.3s ease;
    }

    /* Dark mode toggle */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 12px var(--shadow);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px var(--shadow);
    }

    /* Syntax highlighting overrides */
    .token.comment,
    .token.prolog,
    .token.doctype,
    .token.cdata {
      color: var(--muted);
      font-style: italic;
    }

    .token.punctuation {
      color: var(--fg);
    }

    .token.property,
    .token.tag,
    .token.boolean,
    .token.number,
    .token.constant,
    .token.symbol,
    .token.deleted {
      color: var(--accent);
    }

    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.inserted {
      color: var(--success);
    }

    .token.operator,
    .token.entity,
    .token.url,
    .language-css .token.string,
    .style .token.string {
      color: var(--warning);
    }

    .token.keyword,
    .token.control,
    .token.directive,
    .token.unit {
      color: var(--info);
    }

    /* Print styles */
    @media print {
      body {
        grid-template-columns: 1fr;
        height: auto;
        overflow: visible;
        font-size: 12pt;
        line-height: 1.4;
        color: #000;
        background: #fff;
      }

      aside,
      #topbar .right,
      .theme-toggle {
        display: none;
      }

      main {
        padding: 0;
        overflow: visible;
      }

      #content {
        max-width: none;
      }

      #content pre {
        background: #f5f5f5;
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }

      #content h1,
      #content h2,
      #content h3 {
        page-break-after: avoid;
      }

      #content a {
        color: #000;
        text-decoration: underline;
      }

      #content a[href^="http"]:after {
        content: " (" attr(href) ")";
        font-size: 0.8em;
        color: #666;
      }
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* High contrast mode */
    @media (prefers-contrast: high) {
      :root {
        --border: #000;
        --muted: #666;
      }

      [data-theme="light"] {
        --border: #000;
        --muted: #333;
      }
    }

    /* Focus indicators for keyboard navigation */
    .nav-item:focus-within {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Responsive typography */
    @media (max-width: 480px) {
      #content h1 {
        font-size: 1.6em;
      }

      #content h2 {
        font-size: 1.3em;
      }

      #content h3 {
        font-size: 1.1em;
      }
    }
  </style>
</head>

<body>
  <div class="progress-bar">
    <div class="progress-bar-fill" id="progress-fill"></div>
  </div>

  <aside>
    <div id="brand">
      <i class="bi bi-book"></i>
      ABI Documentation
    </div>
    <div id="desc">Search and browse comprehensive documentation for the ABI ecosystem with advanced features and
      responsive design.</div>
    <input id="search" type="search" placeholder="Search documentation..." autocomplete="off"
      aria-label="Search documentation" />
    <div class="search-results" id="search-results" aria-live="polite"></div>
    <nav id="nav" role="navigation" aria-label="Documentation navigation"></nav>
  </aside>

  <main role="main">
    <div id="topbar">
      <div class="left">
        <nav class="breadcrumb" id="breadcrumb" aria-label="Breadcrumb navigation"></nav>
      </div>
      <div class="right">
        <button class="small" id="copy_link" title="Copy link to current section" aria-label="Copy link">
          <i class="bi bi-link-45deg"></i> Copy Link
        </button>
        <button class="small" id="print_doc" title="Print current document" aria-label="Print document">
          <i class="bi bi-printer"></i> Print
        </button>
        <button class="small" id="open_md" title="View raw Markdown source" aria-label="View source">
          <i class="bi bi-file-text"></i> Source
        </button>
      </div>
    </div>
    <article id="content" role="article"></article>
  </main>

  <button class="theme-toggle" id="theme-toggle" title="Toggle theme" aria-label="Toggle between light and dark theme">
    <i class="bi bi-moon" id="theme-icon"></i>
  </button>

  <!-- Bootstrap JavaScript Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- External dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

  <script>
    // Configuration
    const config = {
      searchResultsLimit: 50,
      searchDebounceMs: 250,
      scrollBehavior: 'smooth',
      enableAnalytics: false,
      autoSave: true,
      cacheTimeout: 300000, // 5 minutes
      maxRetries: 3,
      retryDelay: 1000
    };

    // State management
    let searchData = [];
    let currentPath = '';
    let currentAnchor = '';
    let searchTimeout = null;
    let converter = null;
    let cache = new Map();
    let loadingPromises = new Map();
    let currentTheme = 'auto';

    // GitHub Pages specific configuration
    const getBasePath = () => {
      const path = window.location.pathname;
      const repoName = path.split('/')[1];
      return repoName ? `/${repoName}` : '';
    };

    const basePath = getBasePath();

    // Utility functions
    async function fetchWithRetry(url, options = {}, retries = config.maxRetries) {
      try {
        const response = await fetch(url, options);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response;
      } catch (error) {
        if (retries > 0) {
          await new Promise(resolve => setTimeout(resolve, config.retryDelay));
          return fetchWithRetry(url, options, retries - 1);
        }
        throw error;
      }
    }

    async function fetchJSON(path) {
      const fullPath = path.startsWith('http') ? path : `${basePath}/${path}`;

      if (cache.has(fullPath)) {
        const cached = cache.get(fullPath);
        if (Date.now() - cached.timestamp < config.cacheTimeout) {
          return cached.data;
        }
      }

      try {
        const response = await fetchWithRetry(fullPath);
        const data = await response.json();

        cache.set(fullPath, {
          data,
          timestamp: Date.now()
        });

        return data;
      } catch (error) {
        console.error(`Failed to fetch JSON from ${fullPath}:`, error);
        throw error;
      }
    }

    async function fetchText(path) {
      const fullPath = path.startsWith('http') ? path : `${basePath}/${path}`;

      if (cache.has(fullPath)) {
        const cached = cache.get(fullPath);
        if (Date.now() - cached.timestamp < config.cacheTimeout) {
          return cached.data;
        }
      }

      try {
        const response = await fetchWithRetry(fullPath);
        const data = await response.text();

        cache.set(fullPath, {
          data,
          timestamp: Date.now()
        });

        return data;
      } catch (error) {
        console.error(`Failed to fetch text from ${fullPath}:`, error);
        throw error;
      }
    }

    function escapeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function debounce(func, wait) {
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(searchTimeout);
          func(...args);
        };
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(later, wait);
      };
    }

    function showProgress(show = true) {
      const progressFill = document.getElementById('progress-fill');
      if (show) {
        progressFill.style.width = '30%';
        setTimeout(() => {
          progressFill.style.width = '70%';
        }, 200);
      } else {
        progressFill.style.width = '100%';
        setTimeout(() => {
          progressFill.style.width = '0%';
        }, 300);
      }
    }

    function showError(message, type = 'error') {
      const contentEl = document.getElementById('content');
      let iconClass = 'bi-exclamation-triangle';
      let className = `${type}-message`;

      if (type === 'success') {
        iconClass = 'bi-check-circle';
      } else if (type === 'info') {
        iconClass = 'bi-info-circle';
      }

      contentEl.innerHTML = `<div class="${className}"><i class="bi ${iconClass}"></i>${escapeHTML(message)}</div>`;
    }

    function showLoading(message = 'Loading documentation...') {
      const contentEl = document.getElementById('content');
      contentEl.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>${escapeHTML(message)}</div>
        </div>
      `;
    }

    function updateBreadcrumb(path) {
      const breadcrumbEl = document.getElementById('breadcrumb');
      const parts = path.split('/');
      const fileName = parts[parts.length - 1].replace('.md', '');

      let breadcrumbHTML = '';

      if (parts.length > 1) {
        const directory = parts.slice(0, -1).join('/');
        breadcrumbHTML = `
          <a href="#${encodeURIComponent(directory)}" onclick="loadDirectory('${directory}'); return false;">
            ${escapeHTML(directory)}
          </a>
          <span class="breadcrumb-separator"><i class="bi bi-chevron-right"></i></span>
          <span>${escapeHTML(fileName)}</span>
        `;
      } else {
        breadcrumbHTML = `<span>${escapeHTML(fileName)}</span>`;
      }

      breadcrumbEl.innerHTML = breadcrumbHTML;
    }

    function updateSearchResults(query, results) {
      const searchResultsEl = document.getElementById('search-results');
      if (!query.trim()) {
        searchResultsEl.textContent = '';
        searchResultsEl.style.display = 'none';
        return;
      }

      const count = results.length;
      const total = searchData.length;
      searchResultsEl.textContent = `${count} of ${total} documents match "${query}"`;
      searchResultsEl.style.display = 'block';
    }

    // Enhanced search functionality with fuzzy matching
    function performSearch(query) {
      if (!query.trim()) return searchData;

      const lowerQuery = query.toLowerCase();
      const queryWords = lowerQuery.split(/\s+/).filter(word => word.length > 0);

      const results = searchData.map(item => {
        let score = 0;
        const titleLower = item.title.toLowerCase();
        const excerptLower = item.excerpt.toLowerCase();
        const fileLower = item.file.toLowerCase();

        // Exact title match gets highest score
        if (titleLower === lowerQuery) score += 100;

        // Title contains query gets high score
        else if (titleLower.includes(lowerQuery)) score += 50;

        // Count word matches in title (higher weight)
        queryWords.forEach(word => {
          if (titleLower.includes(word)) score += 20;
          if (excerptLower.includes(word)) score += 10;
          if (fileLower.includes(word)) score += 5;
        });

        // Bonus for matches at the beginning
        if (titleLower.startsWith(lowerQuery)) score += 25;
        if (excerptLower.startsWith(lowerQuery)) score += 15;

        return { ...item, score };
      }).filter(item => item.score > 0);

      // Sort by score (descending) then by title
      results.sort((a, b) => {
        if (b.score !== a.score) return b.score - a.score;
        return a.title.localeCompare(b.title);
      });

      return results.slice(0, config.searchResultsLimit);
    }

    // Theme management
    function initTheme() {
      const savedTheme = localStorage.getItem('abi-docs-theme') || 'auto';
      setTheme(savedTheme);
    }

    function setTheme(theme) {
      currentTheme = theme;
      const body = document.body;
      const themeIcon = document.getElementById('theme-icon');

      body.removeAttribute('data-theme');

      if (theme === 'light') {
        body.setAttribute('data-theme', 'light');
        themeIcon.className = 'bi bi-sun';
      } else if (theme === 'dark') {
        body.setAttribute('data-theme', 'dark');
        themeIcon.className = 'bi bi-moon';
      } else {
        // Auto theme
        themeIcon.className = 'bi bi-circle-half';
      }

      localStorage.setItem('abi-docs-theme', theme);
    }

    function toggleTheme() {
      const themes = ['auto', 'light', 'dark'];
      const currentIndex = themes.indexOf(currentTheme);
      const nextTheme = themes[(currentIndex + 1) % themes.length];
      setTheme(nextTheme);
    }

    // Initialize Showdown converter with GitHub Pages optimizations
    function initConverter() {
      if (typeof showdown === 'undefined') {
        console.warn('Showdown not loaded, falling back to basic Markdown parsing');
        return null;
      }

      const converter = new showdown.Converter({
        headerLevelStart: 1,
        simplifiedAutoLink: true,
        excludeTrailingPunctuationFromURLs: true,
        strikethrough: true,
        tables: true,
        tasklists: true,
        ghCodeBlocks: true,
        smoothLivePreview: true,
        smartIndentationFix: true,
        ghCompatibleHeaderId: true,
        parseImgDimensions: true,
        simpleLineBreaks: true,
        requireSpaceBeforeHeadingText: true
      });

      // Custom extensions for GitHub Pages
      converter.addExtension({
        type: 'output',
        regex: /<a href="(?!http|#)([^"]+)">/g,
        replace: `<a href="${basePath}/$1">`
      }, 'github-pages-links');

      return converter;
    }

    // Enhanced document loading with better error handling
    async function loadDoc(path, retries = config.maxRetries) {
      if (loadingPromises.has(path)) {
        return loadingPromises.get(path);
      }

      const loadingPromise = (async () => {
        try {
          showProgress(true);
          showLoading();

          const [file, anchor] = path.split('#');
          currentPath = file;
          currentAnchor = anchor || '';

          // Update URL without triggering hashchange
          const newUrl = `${window.location.origin}${window.location.pathname}#${encodeURIComponent(path)}`;
          history.replaceState(null, null, newUrl);

          updateBreadcrumb(file);

          const markdown = await fetchText(file);
          const contentEl = document.getElementById('content');

          if (converter) {
            contentEl.innerHTML = converter.makeHtml(markdown);
          } else {
            contentEl.innerHTML = basicMarkdownToHtml(markdown);
          }

          // Process internal links for GitHub Pages
          const links = contentEl.querySelectorAll('a[href]');
          links.forEach(link => {
            const href = link.getAttribute('href');
            if (href && !href.startsWith('http') && !href.startsWith('#') && !href.startsWith('mailto:')) {
              if (href.endsWith('.md')) {
                link.setAttribute('href', `#${href}`);
                link.onclick = (e) => {
                  e.preventDefault();
                  loadDoc(href);
                };
              } else {
                link.setAttribute('href', `${basePath}/${href}`);
              }
            }
          });

          // Highlight syntax if Prism is available
          if (typeof Prism !== 'undefined') {
            Prism.highlightAllUnder(contentEl);
          }

          // Add copy buttons to code blocks
          addCodeCopyButtons(contentEl);

          // Update active navigation item
          updateActiveNavItem(file);

          // Handle anchor scrolling
          if (currentAnchor) {
            setTimeout(() => {
              scrollToAnchor(currentAnchor);
            }, 100);
          } else {
            contentEl.scrollIntoView({ behavior: config.scrollBehavior, block: 'start' });
          }

          // Update page title
          const firstHeading = contentEl.querySelector('h1, h2, h3');
          if (firstHeading) {
            document.title = `${firstHeading.textContent} - ABI Documentation`;
          }

          showProgress(false);

        } catch (error) {
          console.error('Failed to load document:', error);

          if (retries > 0) {
            await new Promise(resolve => setTimeout(resolve, config.retryDelay));
            return loadDoc(path, retries - 1);
          }

          showError(`Failed to load document: ${error.message}`);
          showProgress(false);
        }
      })();

      loadingPromises.set(path, loadingPromise);

      try {
        await loadingPromise;
      } finally {
        loadingPromises.delete(path);
      }
    }

    function scrollToAnchor(anchor) {
      const target = document.getElementById(anchor.toLowerCase()) ||
        document.querySelector(`[id*="${anchor.toLowerCase()}"]`) ||
        document.querySelector(`h1, h2, h3, h4, h5, h6`);

      if (target) {
        target.scrollIntoView({ behavior: config.scrollBehavior, block: 'start' });

        // Highlight the target briefly
        target.style.background = 'var(--hover)';
        target.style.transition = 'background 0.3s ease';
        setTimeout(() => {
          target.style.background = '';
        }, 2000);
      }
    }

    function addCodeCopyButtons(container) {
      const codeBlocks = container.querySelectorAll('pre code');
      codeBlocks.forEach(codeBlock => {
        const pre = codeBlock.parentElement;
        const button = document.createElement('button');
        button.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
        button.className = 'small';
        button.style.position = 'absolute';
        button.style.top = '8px';
        button.style.right = '8px';
        button.style.fontSize = '11px';
        button.style.padding = '4px 8px';
        button.onclick = async () => {
          try {
            await navigator.clipboard.writeText(codeBlock.textContent);
            button.innerHTML = '<i class="bi bi-check"></i> Copied!';
            setTimeout(() => {
              button.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
            button.innerHTML = '<i class="bi bi-x"></i> Failed';
            setTimeout(() => {
              button.innerHTML = '<i class="bi bi-clipboard"></i> Copy';
            }, 2000);
          }
        };

        pre.style.position = 'relative';
        pre.appendChild(button);
      });
    }

    // Basic Markdown parser (enhanced fallback)
    function basicMarkdownToHtml(markdown) {
      const lines = markdown.split('\n');
      let html = '';
      let inCodeBlock = false;
      let codeLanguage = '';
      let inList = false;
      let listType = '';

      for (let i = 0; i < lines.length; i++) {
        let line = lines[i];

        if (line.startsWith('```')) {
          if (!inCodeBlock) {
            inCodeBlock = true;
            codeLanguage = line.slice(3).trim();
            html += `<pre><code class="language-${escapeHTML(codeLanguage)}">`;
          } else {
            inCodeBlock = false;
            html += '</code></pre>';
          }
          continue;
        }

        if (inCodeBlock) {
          html += escapeHTML(line) + '\n';
          continue;
        }

        // Close lists when needed
        if (inList && !(/^\s*[-*0-9]/.test(line) || line.trim() === '')) {
          html += `</${listType}>`;
          inList = false;
        }

        // Headers
        if (line.startsWith('#')) {
          const match = line.match(/^#+/);
          const level = match ? Math.min(match[0].length, 6) : 1;
          const text = line.slice(level).trim();
          const id = text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
          html += `<h${level} id="${id}">${processInlineMarkdown(text)}</h${level}>`;
          continue;
        }

        // Unordered lists
        if (/^\s*[-*] /.test(line)) {
          if (!inList || listType !== 'ul') {
            if (inList) html += `</${listType}>`;
            html += '<ul>';
            inList = true;
            listType = 'ul';
          }
          html += `<li>${processInlineMarkdown(line.replace(/^\s*[-*] /, ''))}</li>`;
          continue;
        }

        // Ordered lists
        if (/^\s*[0-9]+\. /.test(line)) {
          if (!inList || listType !== 'ol') {
            if (inList) html += `</${listType}>`;
            html += '<ol>';
            inList = true;
            listType = 'ol';
          }
          html += `<li>${processInlineMarkdown(line.replace(/^\s*[0-9]+\. /, ''))}</li>`;
          continue;
        }

        // Blockquotes
        if (line.startsWith('>')) {
          html += `<blockquote>${processInlineMarkdown(line.slice(1).trim())}</blockquote>`;
          continue;
        }

        // Horizontal rules
        if (/^[-*_]{3,}$/.test(line.trim())) {
          html += '<hr>';
          continue;
        }

        // Empty lines
        if (line.trim() === '') {
          continue;
        }

        // Paragraphs
        html += `<p>${processInlineMarkdown(line)}</p>`;
      }

      // Close any remaining lists
      if (inList) {
        html += `</${listType}>`;
      }

      return html;
    }

    function processInlineMarkdown(text) {
      return text
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
        .replace(/\*([^*]+)\*/g, '<em>$1</em>')
        .replace(/~~([^~]+)~~/g, '<del>$1</del>')
        .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, `<img alt="$1" src="${basePath}/$2" loading="lazy" />`)
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, (match, text, url) => {
          if (url.startsWith('http') || url.startsWith('#') || url.startsWith('mailto:')) {
            return `<a href="${url}" target="_blank" rel="noopener noreferrer">${text}</a>`;
          } else {
            return `<a href="${basePath}/${url}">${text}</a>`;
          }
        });
    }

    function updateActiveNavItem(filePath) {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      const activeItem = document.querySelector(`[data-file="${filePath}"]`);
      if (activeItem) {
        activeItem.classList.add('active');

        // Scroll into view if needed
        const nav = document.getElementById('nav');
        const itemRect = activeItem.getBoundingClientRect();
        const navRect = nav.getBoundingClientRect();

        if (itemRect.top < navRect.top || itemRect.bottom > navRect.bottom) {
          activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
    }

    function renderNav(items) {
      const navEl = document.getElementById('nav');

      if (items.length === 0) {
        navEl.innerHTML = '<div class="error-message"><i class="bi bi-exclamation-triangle"></i>No documentation found</div>';
        return;
      }

      // Group items by category if they have path structure
      const categories = {};
      items.forEach(item => {
        const parts = item.file.split('/');
        const category = parts.length > 1 ? parts[0] : 'Documentation';
        if (!categories[category]) categories[category] = [];
        categories[category].push(item);
      });

      let html = '';
      Object.entries(categories).forEach(([category, categoryItems]) => {
        if (Object.keys(categories).length > 1) {
          html += `<div class="nav-category">
            <div class="nav-category-title">${escapeHTML(category)}</div>
          </div>`;
        }

        categoryItems.forEach(item => {
          const fileName = item.file.split('/').pop().replace('.md', '');
          const title = item.title || fileName;
          const excerpt = item.excerpt || '';

          html += `<div class="nav-item" data-file="${item.file}" tabindex="0" role="button">
            <a href="#${encodeURIComponent(item.file)}" onclick="loadDoc('${item.file}'); return false;">
              ${escapeHTML(title)}
            </a>
            ${excerpt ? `<div class="nav-excerpt">${escapeHTML(excerpt)}</div>` : ''}
          </div>`;
        });
      });

      navEl.innerHTML = html;

      // Add keyboard navigation
      const navItems = navEl.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            item.querySelector('a').click();
          }
        });
      });
    }

    // Copy link functionality
    async function copyCurrentLink() {
      try {
        const url = window.location.href;
        await navigator.clipboard.writeText(url);

        const button = document.getElementById('copy_link');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="bi bi-check"></i> Copied!';
        setTimeout(() => {
          button.innerHTML = originalText;
        }, 2000);
      } catch (err) {
        console.error('Failed to copy link:', err);
        showError('Failed to copy link to clipboard', 'error');
      }
    }

    // Event handlers
    const debouncedSearch = debounce((query) => {
      const results = performSearch(query);
      updateSearchResults(query, results);
      renderNav(results);
    }, config.searchDebounceMs);

    // Enhanced keyboard shortcuts
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        // Global shortcuts (Ctrl/Cmd + key)
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case 'k':
            case 'f':
              e.preventDefault();
              document.getElementById('search').focus();
              break;
            case 'p':
              e.preventDefault();
              window.print();
              break;
            case 'u':
              e.preventDefault();
              if (currentPath) window.open(`${basePath}/${currentPath}`, '_blank');
              break;
            case 'l':
              e.preventDefault();
              copyCurrentLink();
              break;
          }
        }

        // Non-modifier shortcuts
        switch (e.key) {
          case 'Escape':
            document.getElementById('search').blur();
            break;
          case 't':
            if (!e.ctrlKey && !e.metaKey && !e.altKey && document.activeElement.tagName !== 'INPUT') {
              e.preventDefault();
              toggleTheme();
            }
            break;
        }
      });
    }

    // Service Worker registration for GitHub Pages
    async function registerServiceWorker() {
      if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
        try {
          const registration = await navigator.serviceWorker.register(`${basePath}/sw.js`);
          console.log('Service Worker registered:', registration);
        } catch (error) {
          console.log('Service Worker registration failed:', error);
        }
      }
    }

    // Analytics (optional)
    function trackPageView(path) {
      if (config.enableAnalytics && typeof gtag !== 'undefined') {
        gtag('config', 'GA_MEASUREMENT_ID', {
          page_path: path
        });
      }
    }

    // Initialization
    async function init() {
      try {
        // Initialize theme
        initTheme();

        // Setup keyboard shortcuts
        setupKeyboardShortcuts();

        // Initialize Showdown converter
        converter = initConverter();

        // Register service worker
        registerServiceWorker();

        // Load search data with fallback
        try {
          searchData = await fetchJSON('generated/search_index.json');
        } catch (error) {
          console.warn('Could not load search index:', error);
          // Try alternative locations
          try {
            searchData = await fetchJSON('search_index.json');
          } catch (error2) {
            console.warn('Could not load alternative search index:', error2);
            searchData = [];
            showError('Search index not found. Some features may be limited.', 'info');
          }
        }

        // Initial navigation render
        renderNav(searchData);

        // Determine initial document to load
        const hashPath = location.hash ? decodeURIComponent(location.hash.slice(1)) : '';
        let initialDoc = hashPath;

        if (!initialDoc && searchData.length > 0) {
          // Try to find a README or index file
          const readmeFile = searchData.find(item =>
            item.file.toLowerCase().includes('readme') ||
            item.file.toLowerCase().includes('index')
          );
          initialDoc = readmeFile?.file || searchData[0].file;
        }

        if (!initialDoc) {
          initialDoc = 'generated/API_REFERENCE.md';
        }

        if (initialDoc) {
          await loadDoc(initialDoc);
          trackPageView(initialDoc);
        }

        // Set up event listeners
        document.getElementById('search').addEventListener('input', (e) => {
          debouncedSearch(e.target.value);
        });

        document.getElementById('open_md').addEventListener('click', () => {
          if (currentPath) window.open(`${basePath}/${currentPath}`, '_blank');
        });

        document.getElementById('print_doc').addEventListener('click', () => {
          window.print();
        });

        document.getElementById('copy_link').addEventListener('click', copyCurrentLink);

        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        // Handle browser back/forward
        window.addEventListener('hashchange', () => {
          const path = decodeURIComponent(location.hash.slice(1));
          if (path && path !== currentPath) {
            loadDoc(path);
            trackPageView(path);
          }
        });

        // Handle online/offline status
        window.addEventListener('online', () => {
          showError('Connection restored', 'success');
        });

        window.addEventListener('offline', () => {
          showError('You are offline. Some features may not work.', 'info');
        });

        // Auto-save scroll position
        if (config.autoSave) {
          const main = document.querySelector('main');
          main.addEventListener('scroll', debounce(() => {
            if (currentPath) {
              localStorage.setItem(`scroll-${currentPath}`, main.scrollTop.toString());
            }
          }, 1000));
        }

        console.log('ABI Documentation initialized successfully');

      } catch (error) {
        console.error('Initialization failed:', error);
        showError(`Failed to initialize documentation viewer: ${error.message}`);
      }
    }

    // Start the application
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    // Global error handler
    window.addEventListener('error', (event) => {
      console.error('Global error:', event.error);
      showError('An unexpected error occurred. Please refresh the page.', 'error');
    });

    // Unhandled promise rejection handler
    window.addEventListener('unhandledrejection', (event) => {
      console.error('Unhandled promise rejection:', event.reason);
      showError('An unexpected error occurred. Please refresh the page.', 'error');
    });
  </script>
</body>

</html>