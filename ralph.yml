# Ralph Orchestrator Configuration
# Generated by: abi ralph init
# Enhanced: self-improvement, neural backtracing, multi-domain skills

cli:
  backend: "llama_cpp"

llm:
  backend: "llama_cpp"
  fallback: "mlx,ollama,lm_studio,vllm,plugin_http,plugin_native"
  strict_backend: false
  model: "gpt-oss:120b-cloud"
  plugin: ""

event_loop:
  prompt_file: "PROMPT.md"
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 10

execution:
  max_iterations: 10
  max_fix_attempts: 3
  require_clean_tree: true

gates:
  per_iteration: "zig build verify-all"

# Self-improvement: Ralph learns from its own iterations
self_improvement:
  enabled: true
  skill_extraction: true
  auto_skill: true
  domains:
    - zig
    - ai
    - gpu
    - tui
    - database
    - network
    - constitution
    - abbey
    - multi_agent

  # Neural backtracing: track which code changes improve metrics
  neural_backtrace:
    enabled: true
    track_test_deltas: true
    track_build_time: true
    track_feature_coverage: true
    skill_confidence_threshold: 0.7
    backtrace_window: 5  # Look back N iterations for causal links

  # Self-improvement targets: patterns Ralph should learn from
  targets:
    - pattern: "test baseline increase"
      action: "extract skill and update baselines"
    - pattern: "build time reduction"
      action: "extract optimization pattern"
    - pattern: "new feature module"
      action: "verify 9 integration points"
    - pattern: "stub parity fix"
      action: "extract mod/stub sync pattern"
    - pattern: "constitution violation"
      action: "strengthen enforcement rules"

# Multi-agent coordination (future)
multi_agent:
  enabled: false
  max_agents: 4
  transport: "tcp"
  discovery: "local"
  coordination: "raft"  # Consensus for shared state
  roles:
    - name: "architect"
      focus: ["design", "api", "architecture"]
    - name: "implementer"
      focus: ["code", "tests", "features"]
    - name: "reviewer"
      focus: ["quality", "security", "performance"]
    - name: "integrator"
      focus: ["build", "ci", "deployment"]

# Cross-platform support
platform:
  targets:
    - os: "macos"
      arch: ["aarch64", "x86_64"]
      gpu: "metal"
      transport: ["tcp", "thunderbolt"]
    - os: "linux"
      arch: ["x86_64", "aarch64"]
      gpu: "cuda,vulkan"
      transport: ["tcp", "tls"]
    - os: "windows"
      arch: ["x86_64"]
      gpu: "vulkan,cuda"
      transport: ["tcp", "tls"]
